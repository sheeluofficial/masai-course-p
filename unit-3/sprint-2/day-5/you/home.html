<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
    <style>


.movie-box h3{
margin: 0;
}

.res{
    background-color: red;
    color: royalblue;
    padding: 3px;
}

.movie-box button{
    background-color: royalblue;
    justify-content: center;
    padding: 6px;
    border: 0;
    height: 30px;
    width: 80%;
    margin: auto;
    border-radius: 5px;
    transition: 0.3s;
}
.movie-box button:hover{
    height: 35px;
    width: 85%;
}
        .container{
            display: flex;
            flex-direction: column;
            gap: 30px;
            
        }
        #search-bar{
            height: 35px;
            width: 300px;
            background: cornflowerblue;
            /* border: 0; */
            padding: 5px;
            border-radius: 7px;


        }
        #search-btn{

            height: 45px;
            padding: 5px;
            background: salmon;
            width: 150px;
            border: 0;
            border-radius: 6px;
            transition: 0.1s ease-in;


        }
        #search-btn:hover{
            width: 160px;
            height: 50px;
        }

        .movie-input-box
       {
            display: flex;
            flex-direction: row;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            position: relative;
        }

.search-result-box, 
.local-result-box{
    display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: flex-start;
            gap: 20px;
            margin-top: 20px;
    flex-direction: column;
    border-radius: 20px;

    min-height: 50vh;
    background: cornflowerblue;
 
}
.search-result-box{
    gap: 10px;
   min-height: 60vh;
} .search-result-box .movie-box{
    height: 30px;
}
/* .search-result img{
height: 250px;
}  */


.local-result{
    display: grid;
    grid-template-columns: repeat(5,1fr);
    gap: 20px;
}


.search-result img,
.local-result img{
    height: 250px;
    width: 90%;
    margin: auto;
    border-radius: 7px ;
    transition: 0.5s ease-in-out;
}
.search-result img{
    height: 200px;

}
.search-result img:hover{
    height: 210px;
}

.local-result img:hover{
    height: 255px;
    width: 95%;
}

.movie-box{
    height: 350px;
    
}

 .search-result .movie-box {
    height: 300px;
 }

#search-suggest{
    max-height: 500px;
    overflow-y: scroll;
    width: 300px;
    position: absolute;
    left: calc(50% - 235px);
    top: 48px;
    /* visibility: hidden; */
    background-color: blue;
    display: flex;
    flex-direction: column;
}
.suggest-box-one {
    display: flex;
    height: 50px;
    flex-direction: row;
    width: 90%;
    margin: auto;
    gap: 5px;
}
.suggest-box-one img{
    height: 100%;
    width: 80px;
}


    </style>
</head>
<body>
    <div class="container">
        <div class="movie-input-box">
            <input type="text" class="movie-input" id="search-bar" placeholder="Enter Movie name">
            <div id="search-suggest">

            </div>
            <button id="search-btn">Get movie</button>

        
        </div>

        <div class="search-result-box">
            <h2>Search result</h2>
            <div class="search-result"></div>
        </div>
        <div class="local-result-box">
            <h2>Previous Searches</h2>
            <div class="local-result"></div>
        </div>
    </div>
</body>
</html>

<script>
    let movieData = JSON.parse(localStorage.getItem("movieData")) ?? [];
    let url = `http://www.omdbapi.com/?apikey=d2fda3cc&t=`;
    let key = `d2fda3cc`;
    let clearSearchSuggest;

document.querySelector("#search-btn").addEventListener("click",()=>{
    clearInterval(clearSearchSuggest)
    document.getElementById("search-suggest").innerHTML = "";
    document.getElementById("search-suggest").style.visibility = "hidden"
    getData()
})

async function getData() {
    try{
        let movie = document.getElementById("search-bar").value;
    let title = movie.split(" ").join("+");
    let res = await fetch(`${url}+${title}`)
    let data = await res.json()
     movieData.unshift(data);
     localStorage.setItem("movieData",JSON.stringify(movieData));
// console.log(data.imdbRating>8.4) 
     resentShow(data);
     preShow(movieData);
    } catch(err) {
       let body = document.querySelector("body");
       console.log(err+"  an err")

    } 
}



function resentShow(element) {

     let mainDiv = document.querySelector(".search-result");
     mainDiv.innerHTML = "";

    //  data.forEach(element => {
         let movie_box = document.createElement("div");
         movie_box.setAttribute("class","movie-box")

         let movieP = document.createElement("img");
         movieP.src = element.Poster;

         let Title = document.createElement("h3");
         Title.innerText = element.Title;

         let info_d_r = document.createElement("div");
         let span_d = document.createElement("span");
         span_d.innerText = ` ${element.Director}, `;

         let span_r = document.createElement("span");
         span_r.innerText = element.Released;
         info_d_r.append(span_d,span_r);

         let genre = document.createElement("div");
         genre.innerText = element.Genre;
let button = document.createElement("button");
button.innerText = "Watch Now"
         if(element.imdbRating>8.4) {
    let h4 = document.createElement("h4").innerText="Recommended"
    h4.setAttribute("class","rec")
    movie_box.append(movieP,Title,info_d_r,genre,h4,button)
         } else {
            movie_box.append(movieP,Title,info_d_r,genre,button)
         }
       
         mainDiv.append(movie_box)
    //  });
 }
 preShow(movieData);
 function preShow(data) {
     let mainDiv = document.querySelector(".local-result");

     mainDiv.innerHTML = "";

     data.forEach(element => {
         let movie_box = document.createElement("div");
           movie_box.setAttribute("class","movie-box")
         let movieP = document.createElement("img");
         movieP.src = element.Poster;

         let Title = document.createElement("h3");
         Title.innerText = element.Title;

         let info_d_r = document.createElement("div");
         let span_d = document.createElement("span");
         span_d.innerText = ` ${element.Director}, `;

         let span_r = document.createElement("span");
         span_r.innerText = element.Released;
         info_d_r.append(span_d,span_r);

         let genre = document.createElement("div");
         genre.innerText = element.Genre;

         genre.innerText = element.Genre;
let button = document.createElement("button");
button.innerText = "Watch Now"
         if(data.imdbRating>8.4) {
    let h4 = document.createElement("h4").innerText="Recommended"
    h4.setAttribute("class","rec")
    movie_box.append(movieP,Title,info_d_r,genre,h4,button)
         } else {
            movie_box.append(movieP,Title,info_d_r,genre,button)
         }
         mainDiv.append(movie_box)
     });
 }

 

    document.getElementById("search-bar").addEventListener("keypress",()=>{
        let query = document.getElementById("search-bar").value;
        if(query.length>=2) {
    
                   dBounce(searchSuggest)
        }
    })

   function dBounce(searchSuggest) {
       clearTimeout(clearSearchSuggest)

       clearSearchSuggest = setTimeout(() => {
           searchSuggest()
       }, 3000);
   }


async function searchSuggest() {
    try{
        let movie = document.getElementById("search-bar").value;
        let res = await fetch(`http://www.omdbapi.com/?apikey=d2fda3cc&s=${movie}`)

        let data = await res.json()
        console.log(data.Search)
        showSuggest(data.Search)
    } catch(err) {
        console.log(err)
    }
     

}

async function searchById(id) {
    document.getElementById("search-suggest").style.visibility = "hidden"
    let res = await fetch(`http://www.omdbapi.com/?apikey=d2fda3cc&i=${id}`)
    let data = await res.json()
    movieData.unshift(data);
     localStorage.setItem("movieData",JSON.stringify(movieData));
// console.log(data.imdbRating>8.4) 
     resentShow(data);
     preShow(movieData);
    console.log(data)
}

function showSuggest(movies) {
    document.getElementById("search-suggest").style.visibility = "visible"
        if(movies===undefined) {
            return false
        }  
        let movies_div =document.getElementById("search-suggest")
        movies_div.innerHTML =""
        movies.forEach(({Poster,Title,Year,imdbID}) => {
            let box = document.createElement("div")
            box.addEventListener("click",()=>{
                searchById(imdbID)
            })
          box.setAttribute("class","suggest-box-one")
          let img = document.createElement("img");
          img.src = Poster;
            let p = document.createElement("p");
             p.innerText = Title;
             let h4 = document.createElement("h4")
             h4.innerText = Year;
             p.append(h4)
             box.append(img,p)
            movies_div.append(box);
        });
        
    }

</script>